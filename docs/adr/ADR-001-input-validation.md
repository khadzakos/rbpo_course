# ADR-001: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ –∏ –∑–∞–≥—Ä—É–∑–æ–∫

## –°—Ç–∞—Ç—É—Å
–í—ã–ø–æ–ª–Ω–µ–Ω–æ

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ API –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —Ä–∏—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ magic bytes –¥–ª—è —Ñ–∞–π–ª–æ–≤
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—É—Ç–µ–π
- –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç —Å–∏–º–ª–∏–Ω–∫–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤

## –†–µ—à–µ–Ω–∏–µ
–í–Ω–µ–¥—Ä–∏—Ç—å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ magic bytes –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (–º–∞–∫—Å–∏–º—É–º 10MB)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ (–º–∞–∫—Å–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥)
- –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö MIME —Ç–∏–ø–æ–≤

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—É—Ç–µ–π
- –ö–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø—É—Ç–µ–π –∫ —Ñ–∞–π–ª–∞–º
- –ó–∞–ø—Ä–µ—Ç —Å–∏–º–ª–∏–Ω–∫–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UUID –¥–ª—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫ –∏ —á–∏—Å–ª–æ–≤—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è email –∞–¥—Ä–µ—Å–æ–≤

## –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ
- –ó–∞—â–∏—Ç–∞ –æ—Ç path traversal –∞—Ç–∞–∫
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ó–∞—â–∏—Ç–∞ –æ—Ç DoS –∞—Ç–∞–∫ —á–µ—Ä–µ–∑ –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã
- –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∏–º–∏—Ç–æ–≤

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
```python
# –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
ALLOWED_MIME_TYPES = ['image/jpeg', 'image/png', 'application/pdf']
MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB
MAX_UPLOAD_TIME = 30  # —Å–µ–∫—É–Ω–¥

# –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π
def sanitize_filename(filename: str) -> str:
    # –£–¥–∞–ª–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID –∏–º–µ–Ω–∏
    pass
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏
- [x] –í—Å–µ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ magic bytes
- [x] –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 10MB
- [x] –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ 30 —Å–µ–∫—É–Ω–¥–∞–º–∏
- [x] –í—Å–µ –ø—É—Ç–∏ –∫–∞–Ω–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [x] –°–∏–º–ª–∏–Ω–∫–∏ –∑–∞–ø—Ä–µ—â–µ–Ω—ã
- [x] –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç UUID
- [x] HTML/SQL –∏–Ω—ä–µ–∫—Ü–∏–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã
- [x] Path traversal –∞—Ç–∞–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
- [x] Email –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [x] –î–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞

## –°–≤—è–∑–∏

### NFR
- **NFR-03**: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (100% –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic)

### –†–∏—Å–∫–∏ (–∏–∑ RISKS.md)
- **R5**: –ü–æ–¥–¥–µ–ª–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (12) - **–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–∫—Ä—ã—Ç–∏—è**: Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∫—Ä—ã–≤–∞–µ—Ç 100% –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –¢–µ—Å—Ç—ã
- `test_security.py` - 20 —Ç–µ—Å—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `TestInputValidation` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `TestSecurityAttacks` - –∑–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫
- `TestSecurityIntegration` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
‚úÖ **–°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (`app/security.py`)
- –ö–ª–∞—Å—Å `InputValidator` —Å –º–µ—Ç–æ–¥–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç XSS, SQL –∏–Ω—ä–µ–∫—Ü–∏–π, path traversal
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤, email, —Ä–∞–∑–º–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö

‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ API** (`app/api.py`)
- Pydantic –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∞

‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (`tests/test_security.py`)
- 20 —Ç–µ—Å—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ –∞—Ç–∞–∫
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –°—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–¥
- [InputValidator –∫–ª–∞—Å—Å](app/security.py#62-159)
- [Pydantic –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã](app/api.py#19-116)
- [–¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](tests/test_security.py#14-73)

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
1. **–¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∑–∞—â–∏—Ç–∞
2. **–°—Ç–æ—Ä–æ–Ω–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏** - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Ä–µ—à–µ–Ω–∏–π
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - –ø–æ–∑–¥–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

–í—ã–±—Ä–∞–Ω–æ —Ä–µ—à–µ–Ω–∏–µ —Å –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ API –¥–ª—è —Ä–∞–Ω–Ω–µ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∞—Ç–∞–∫.

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –°—Ç–∞—Ç—É—Å: –í–´–ü–û–õ–ù–ï–ù–û
- **–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 2024-01-15
- **–¢–µ—Å—Ç—ã**: 20/20 –ø—Ä–æ—Ö–æ–¥—è—Ç ‚úÖ
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: 100% –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ó–∞—â–∏—Ç–∞ –æ—Ç OWASP Top 10

### üìä –ú–µ—Ç—Ä–∏–∫–∏
- **–í—Ä–µ–º—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏**: < 1ms –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: 100% –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π
- **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ç–∞–∫–∏**: XSS, SQL injection, path traversal
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ë–µ–∑ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ API
